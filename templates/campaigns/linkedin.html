{% extends 'base.html' %}
{% block title %}My Campaigns – Easy Biz Deal{% endblock %}

{% block head_extra %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/campaigns.css') }}">
{% endblock %}

{% block content %}
<div class="container py-4">

  <!-- Flash Messages -->
  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      <div class="mb-4">
        {% for category, message in messages %}
          <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
          </div>
        {% endfor %}
      </div>
    {% endif %}
  {% endwith %}

  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="mb-0">📋 My Campaigns</h2>
    <a href="{{ url_for('create_linkedin_campaign') }}" class="btn btn-success">
      ➕ Create New Campaign
    </a>
  </div>

  <!-- LinkedIn Setup Reminder -->
  <div class="alert alert-warning d-flex justify-content-between align-items-center mb-4">
    <div>
      ⚙️ 
      {% if current_user.linkedin_cookie %}
        <strong class="text-success">✅ You are connected to LinkedIn</strong>
      {% else %}
        <strong class="text-danger">❌ Not connected to LinkedIn</strong>
      {% endif %}
    </div>

    {% if current_user.linkedin_cookie %}
      <a href="{{ url_for('linkedin_disconnect') }}" class="btn btn-sm btn-danger">
        🔌 Disconnect LinkedIn
      </a>
    {% else %}
      <a href="{{ url_for('linkedin_login_silent') }}" class="btn btn-sm btn-primary">
        🔐 Connect to LinkedIn
      </a>
    {% endif %}
  </div>

  {% if campaigns %}
    <div class="row gy-3">
      {% for campaign in campaigns %}
      <div class="col-12">
        <div class="card shadow-sm p-4">
          <div class="d-flex justify-content-between align-items-center mb-2">
            <h5 class="mb-0">{{ campaign.campaign_name }}</h5>
            <span class="badge text-bg-success text-capitalize">{{ campaign.tool_name }}</span>
          </div>
          <p class="mb-1 text-muted">
            📁 <strong>Folder:</strong> {{ campaign.upload_file.folder_name if campaign.upload_file else '' }} |
            📄 <strong>File:</strong> {{ campaign.upload_file.filename if campaign.upload_file else '' }}
          </p>
          <p class="mb-2">
            <strong>Message:</strong> {{ campaign.message_body[:100] }}...
          </p>

          <!-- Action Buttons -->
          <div class="mt-3 d-flex flex-wrap gap-2 justify-content-end">
            <!-- Edit -->
            <a href="{{ url_for('edit_campaign', campaign_id=campaign.id) }}" class="btn btn-outline-warning btn-sm">
              ✏️ Edit
            </a>

            <!-- Delete -->
            <form method="POST" action="{{ url_for('delete_campaign', campaign_id=campaign.id) }}" onsubmit="return confirm('Are you sure you want to delete this campaign?')">
              <button type="submit" class="btn btn-outline-danger btn-sm">
                🗑️ Delete
              </button>
            </form>
            
            <!-- Tools -->
<form method="POST" action="{{ url_for('send_test_message', campaign_id=campaign.id) }}" style="display: inline;">
  <button type="submit" class="btn btn-outline-warning btn-sm">📤 Send Test</button>
</form>
<a href="#" class="btn btn-outline-secondary btn-sm disabled">▶ Run</a>
<a href="#" class="btn btn-outline-secondary btn-sm disabled">📅 Schedule</a>
<a href="#" class="btn btn-outline-secondary btn-sm disabled">📊 Live Report</a>
</div>
</div>
</div>

      {% endfor %}
    </div>
  {% else %}
    <p class="text-muted">You haven’t created any campaigns yet.</p>
  {% endif %}
</div>
{% endblock %}
