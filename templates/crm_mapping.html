{% extends 'base.html' %}

{% block title %}Map Columns ‚Äì Easy Biz Deal{% endblock %}

{% block head_extra %}
  <link rel="stylesheet" href="{{ url_for('static', filename='css/crm_mapping.css') }}">
{% endblock %}

{% block content %}
<div class="container py-4 crm-mapping-container">

  <!-- Mapping Form -->
  <div class="card shadow-sm p-4">
    <h3 class="mb-4">üß† Map Your Columns</h3>

    <form method="POST" action="{{ url_for('save_mapping') }}" autocomplete="off">
      <input type="hidden" name="file" value="{{ file }}">
      <input type="hidden" name="folder" value="{{ folder }}">

      <div class="row">
        {% for field in [
          'Email', 'First Name',
          'LinkedIn URL', 'Title', 'Company Name', 'Company Website',
          'Country', 'State', 'City', 'Notes'
        ] %}
        <div class="col-md-6 col-lg-4 mb-3">
          <label class="form-label">{{ field }}</label>
          <select name="mapping[{{ field|lower|replace(' ', '_') }}]" class="form-select">
            <option value="">-- No Mapping --</option>
            {% for col in columns %}
              <option value="{{ col }}">{{ col }}</option>
            {% endfor %}
          </select>
        </div>
        {% endfor %}
      </div>

      <button type="submit" class="btn btn-success w-100 mt-3">‚úÖ Save Mapping</button>
    </form>
  </div>

  <!-- Preview Table -->
  <div class="card shadow-sm p-4 mt-4">
    <h4 class="mb-3">üîç Preview (First 3 Rows)</h4>

    {% if columns and preview %}
    <div class="table-responsive">
      <table class="table table-bordered table-striped">
        <thead class="table-light">
          <tr>
            {% for col in columns %}
              <th>{{ col }}</th>
            {% endfor %}
          </tr>
        </thead>
        <tbody>
          {% for row in preview %}
            <tr>
              {% for col in columns %}
                <td>{{ row[col] }}</td>
              {% endfor %}
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    {% else %}
    <p class="text-muted">No preview data available.</p>
    {% endif %}
  </div>

</div>
{% endblock %}
